---
title: "11-01-ann"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


One new package: pacman to install and load packages. 

```{r}
pacman::p_load(neuralnet, caret, tidyverse)

cheese <- read.csv("tinydata.csv")


```

We have to create each indicator variable separately. Below is a cleaner way of creating a formula.

```{r}
cheese$Like <- cheese$Acceptance=="like"
cheese$Dislike <- cheese$Acceptance=="dislike"

# A neat way to create formulas:

## Step 1: get x and y vars
xvars <- colnames(cheese[, 2:3])
yvars <- colnames(cheese[, 5:6])

## Step 2: Insert a + in between the x vars and y vars
xvars <- paste(xvars, collapse = ' + ')
yvars <- paste(yvars, collapse = ' + ')

## Step 3: Connect them with the ~ for formula
forml <- paste(yvars, "~", xvars)

## Step 4: Make the expression into a formula.
forml <- as.formula(forml)
forml


```

Let's run a basic neural network model with one hidden layer and three nodes.


```{r}
nn1 <- neuralnet(forml, data = cheese,
                 linear.output = F ,
                 rep = 1,
                 hidden = 3, 
                 threshold = 0.01,
                 err.fct = "sse" ,
                 act.fct = "logistic")



# Matrix of results and weights
nn1$result.matrix


# Display the weights at each node
nn1$weights


```

Here the first row is the bias on the hidden layer, second row is the outputs from fat to the three noes, third row is the output from the salt to the three nodes.

Let's plot this.

```{r}
plot(nn1)
```


Now, let's work with the predictions. we can obtain results using the `nn1$net.result` command or the `predict` function. The latter is useful with newdata.

```{r}
# Overall result of the network (note: if rep = k, all k are shown)
nn1$net.result

# using predict


pred1 <- predict(nn1, newdata = cheese)
cheese$predcl  <- ifelse(pred1 > 0.5, "Like", "Dislike")


```

