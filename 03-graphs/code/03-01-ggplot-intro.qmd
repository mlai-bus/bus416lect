---
title: "03-01-ggplot-intro"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Grammar of graphs

According to Hadley Wickham, a plot or a graph is defined by the following components:

-   a default dataset and set of mappings from variables to aesthetics

-   one or more layers, with each layer having one geometric object, one statistical transformation, one position adjustment, and optionally, one dataset and set of aesthetic mappings

-   one scale for each aesthetic mapping used

-   a coordinate system

-   the facet specification

A dataset consists of variables which need to be mapped to a graph. These mappings are called aesthetics. The actual observations are shown on the graph using the various geoms (for example, point, line, boxplot etc). These values may appear by themselves, or first undergo some statistical transformation and then get plotted. What sets this approach apart is that these mappings and geoms are built in a **layered fashion**, enabling one to add multiple visuals on the chart. Borrowing the term from Tufte, this allows for plotting of multiple dimensions on a single two dimensional chart.

These geoms can in turn be customized by size, shape, transparency, color etc.

The scales of the axis can be adjusted as well (log transforms for example), without transforming the underlying data. The co-ordinate systems can also be changed between the traditional Cartesian or polar.

Finally, instead of representing all the groups in a single graph, a separate graph can be plotted for each group. This is called faceting. The layered construction of plots also allows for the addition of labels, text annotations, lines etc on to the graph. We will explore all these elements next.

```{r, echo = FALSE}
library(tidyverse)
```

We will use a built-in dataset about cars.

```{r}

df <- as_tibble(mpg)
str(df)

```

### Initializing a plot

Calling ggplot and creating a blank window with just the axis:

```{r}
g1 <- df |> 
  ggplot(aes(x = displ, y = hwy))
g1
```

Thus, we have mapped displ to x axis and hwy to y axis. These are the aesthetics.

### Geoms

Next, we will populate this with the data using geoms

```{r}
 df  |> 
  ggplot(aes(x = displ, y = hwy, color = class)) +
  geom_point()

# or, using the layered approach:

g1 +
  geom_point( size = 3)
```

We can add a smooth line.

```{r}
g1 +
  geom_point() +
  geom_smooth(se = F)

```

### Changing aesthetics within layers

We can switch to a regression line. We can also add various elements to the point geom. These elements are called aesthetics (color, shape, size etc). Generally, aesthetics are inherited from the main mapping. They can however be superseeded by individual layers. Let us also color the points by class.

```{r}

g1 +
  geom_point(aes(color = class)) +
  geom_smooth(method = "lm", se = F)




```

```{r}

g1 +
  geom_point(aes(color = class)) +
  geom_smooth(method = "lm", se = F, size = 3)




```

To have a separate line for each class:

inheritance

```{r}

g1 +
  geom_point(aes(color = class, shape = drv)) +
  geom_smooth(method = "lm", se = F, aes(color = drv))


```

In the above, we have separated out cars based on front, rear or all wheel.

### Scales

`ggplot` automatically added scales, labels and tick marks to the axis. Suppose we want to have tick marks on the y axis at every 5 miles per gallon.

```{r}

g1 +
  geom_point(aes(color = drv, shape = drv)) +
  geom_smooth(method = "lm", se = F, aes(color = drv)) +
  scale_y_continuous(breaks = seq(0,50,5))  #seq(ini, fin, steps) 




```

### Facets

Let us do a separate scatter chart for each drive type

```{r}

g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class)) 

# two columns
g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class), ncol = 2) 

# facet by class and drv
g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class, drv)) 

# we can let each facet have its own scale
g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class), scales = "free") 



```

### Labels

Labels can be specified within the `labs()` arguments. Options include title, subtitle, caption and x = / y = for axis

```{r}
g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class)) +
  labs(title = "Miles per gallon vs Engine Displacement",
       subtitle = "Separated by Class",
       caption = "Source: tidyverse built in dataset",
       x = "Engine Displacement",
       y = "Highway miles per gallon")

```

There are several themes that can be used to further customize the chart.

```{r}
g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class)) +
  labs(title = "Miles per gallon vs Engine Displacement",
       subtitle = "Separated by Class",
       caption = "Source: tidyverse built in dataset",
       x = "Engine Displacement",
       y = "Highway miles per gallon") +
  theme_minimal()

# one of my favorites
library(ggthemes)

g1 +
  geom_point(aes(color = drv, shape = drv)) +
  scale_y_continuous(breaks = seq(0,50,5)) +
  facet_wrap(vars(class)) +
  labs(title = "Miles per gallon vs Engine Displacement",
       subtitle = "Separated by Class",
       caption = "Source: tidyverse built in dataset",
       x = "Engine Displacement",
       y = "Highway miles per gallon") +
  theme_economist()



```

### Some other univariate plots

```{r}

g2 <- df |> 
  ggplot(aes(x = hwy)) +
  geom_density() +
  labs(title = "Density Plot of miles per gallon")
g2


g3 <- df |> 
  ggplot(aes(x = class)) +
  geom_bar() +
  labs(title = "Count of cars by class")
g3


g4 <- df |> 
  ggplot(aes(x = cyl, y = hwy, color = drv)) +
  geom_point() +
  labs(title = "Miles per Gallon Vs Cylinders")

g4

# better approach
g5 <- df |> 
  ggplot(aes(x = cyl, y = hwy, color = drv)) +
  geom_point() +
  geom_jitter() +
  labs(title = "Miles per Gallon Vs Cylinders")

g5

```

Jittering adds some randomness to the data which helps with visualization. Suppose we want to collect g2, g3 and g5, with g2 and g3 side-by-side with g5 in the bottom

```{r}
library(patchwork)

(g2 + g3) /g5
```
